private func createAccount() {
    // Reset any previous error states
    showAlert = false
    alertMessage = ""
    
    // Validate input
    guard !nickname.isEmpty else {
        alertTitle = "Missing Nickname"
        alertMessage = "Please enter a nickname for your account."
        showAlert = true
        return
    }
    guard !email.isEmpty else {
        alertTitle = "Missing Email"
        alertMessage = "Please enter your email address."
        showAlert = true
        return
    }
    guard !password.isEmpty else {
        alertTitle = "Missing Password"
        alertMessage = "Please enter a password."
        showAlert = true
        return
    }
    guard password == confirmPassword else {
        alertTitle = "Passwords Don't Match"
        alertMessage = "Please make sure your passwords match."
        showAlert = true
        return
    }
    guard password.count >= 6 else {
        alertTitle = "Password Too Short"
        alertMessage = "Password must be at least 6 characters long."
        showAlert = true
        return
    }
    guard email.contains("@") && email.contains(".") else {
        alertTitle = "Invalid Email"
        alertMessage = "Please enter a valid email address."
        showAlert = true
        return
    }

    isCreatingAccount = true

    Auth.auth().createUser(withEmail: email, password: password) { result, error in
        DispatchQueue.main.async {
            if let error = error {
                isCreatingAccount = false
                let errorMessage = getErrorMessage(for: error)
                alertTitle = "Account Creation Failed"
                alertMessage = errorMessage
                showAlert = true
                return
            }

            guard let user = result?.user else {
                isCreatingAccount = false
                return
            }
            
            // Send verification email
            user.sendEmailVerification { error in
                isCreatingAccount = false
                if let error = error {
                    alertTitle = "Verification Failed"
                    alertMessage = "Could not send verification email: \(error.localizedDescription)"
                    showAlert = true
                } else {
                    alertTitle = "Verify Your Email"
                    alertMessage = "We sent a verification link to your email. Please verify your email before signing in."
                    showAlert = true
                }
            }

            // Save user data to Firestore
            let userData: [String: Any] = [
                "nickname": nickname,
                "email": email,
                "createdAt": Timestamp(),
                "notificationFrequency": "Every 12 Hours",
                "intervalHours": 12,
                "updatedAt": Date().timeIntervalSince1970 * 1000
            ]

            Firestore.firestore().collection("users").document(user.uid).setData(userData) { error in
                // No need to show success alert here, user must verify email first
            }
        }
    }
}